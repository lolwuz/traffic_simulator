<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Trafic Simulator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta http-equiv="cleartype" content="on">
    <meta name="format-detection" content="telephone=no">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background-color: black;
        }

        #jquery-container {
            padding: 1rem 0 0 0;
        }

        #phaser-container {
            padding: 0 0 0 0;
            height: 100vh;
        }

        .container-fluid {
            background-color: black;
        }

        .list-group-item {
            float: left;
            margin: 10px;
            padding: 10px;
        }
    </style>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- development version, includes helpful console warnings -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
<div class="container-fluid">
    <div class="row">
        <div id="phaser-container" class="col-10">
            <div id="content"></div>
        </div>
        <div id="jquery-container" class="col-2">
            <div class="row">
                <div class="col-6">
                    <ul id="light-col-1" class="list-group"></ul>
                </div>
                <div class="col-6">
                    <ul id="light-col-2" class="list-group"></ul>
                </div>
            </div>

        </div>
    </div>
</div>


<!-- uncomment the line bellow for cordova feature -->
<!-- <script type="text/javascript" src="cordova.js"></script> -->

<script>
  // Create WebSocket connection.
  const socket = new WebSocket('ws://localhost:8080')
  const lights = ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10', 'B1', 'B2', 'B3', 'C1.1', 'C1.2', 'C2.1', 'C2.2', 'C3.1', 'C3.2', 'D1', 'E1']

  console.log(lights)
  // Add lights
  for (let i = 0; i < lights.length; i++) {
	console.log('test')
	console.log(lights[i])

	let light_html = `<div id="` + lights[i] + `" class="card text-white bg-danger mb-3"><div class="card-header"><b>` + lights[i] + `</b></div></div>`

	if (i < 11)
	  $('#light-col-1').append(light_html)
    else
      $('#light-col-2').append(light_html)
  }

  // Connection opened
  socket.addEventListener('open', function (event) {
	console.log('Entry from the server')
  })

  // Listen for messages
  socket.addEventListener('message', function (event) {
	server_data = JSON.parse(event.data)

	console.log(server_data)

    for(let i = 0; i < server_data.length; i++) {
      let light = server_data[i]
      let cl = 'card text-white bg-danger mb-3'

      switch(light.status) {
        case "green":
          cl = 'card text-white bg-success mb-3'
          break
		case "orange":
		  cl = 'card text-white bg-warning mb-3'
		  break
		case "red":
		  cl = 'card text-white bg-danger mb-3'
		  break
      }

      $("#" + light.name).attr('class', cl);
    }
  })

</script>
<script type="text/javascript" src="./dist/vendor.bundle.js"></script>
<script type="text/javascript" src="./dist/bundle.js"></script>
</body>


</html>
