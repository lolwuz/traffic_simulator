<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Trafic Simulator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta http-equiv="cleartype" content="on">
    <meta name="format-detection" content="telephone=no">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
        }

        #jquery-container {
            padding: 1rem 0 0 0;
            display: none;
        }

        #phaser-container {
            padding: 0 0 0 0;
            height: 100vh;
        }

        .list-group-item {
            float: left;
            margin: 10px;
            padding: 10px;
        }
    </style>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- development version, includes helpful console warnings -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
<div id="jquery-container">
    <div class="row">
        <div class="col-6">
            <ul id="light-col-1" class="list-group"></ul>
        </div>
        <div class="col-6">
            <ul id="light-col-2" class="list-group"></ul>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div id="phaser-container" class="col-12">
            <div id="content">
            </div>
        </div>
    </div>
</div>


<!-- uncomment the line bellow for cordova feature -->
<!-- <script type="text/javascript" src="cordova.js"></script> -->

<script>
  // Create WebSocket connection.
  const socket = new WebSocket('ws://159.69.219.206:8080')
  const lights = ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9', 'A10', 'B1', 'B2', 'B3', 'C1.1', 'C1.2', 'C2.1', 'C2.2', 'C3.1', 'C3.2', 'D1', 'F1', "F2"]
  var serverData = [{light: 'A1', status: 'red'}, {light: 'A2', status: 'red'}, {light: 'A3', status: 'red'}, {light: 'A4', status: 'red'}, {light: 'A5', status: 'red'}, {light: 'A6', status: 'red'}, {light: 'A7', status: 'red'}, {light: 'A8', status: 'red'}, {light: 'A9', status: 'red'}, {light: 'A10', status: 'red'},
    {light: 'B1', status: 'red'}, {light: 'B2', status: 'red'}, {light: 'B3', status: 'red'},
    {light: 'C1.1', status: 'red'}, {light: 'C1.2', status: 'red'}, {light: 'C2.1', status: 'red'}, {light: 'C2.2', status: 'red'}, {light: 'C3.1', status: 'red'}, {light: 'C3.2', status: 'red'},
    {light: 'D1', status: 'red'}, {light: 'F1', status: 'red'}, {light: 'F2', status: 'red'}]

  // Add lights
  for (let i = 0; i < lights.length; i++) {
	let light_html = `<div id="` + lights[i] + `" class="card text-white bg-danger mb-3"><div class="card-header"><b>` + lights[i] + `</b></div></div>`

	if (i < 11)
	  $('#light-col-1').append(light_html)
    else
      $('#light-col-2').append(light_html)
  }

  // Connection opened
  socket.addEventListener('open', function (event) {
	console.log('Entry from the server')
  })

  // Listen for messages
  socket.addEventListener('message', function (event) {
    dataJson = JSON.parse(event.data)

    for(let i = 0; i < dataJson.length; i++) {
      for(let y = 0; y < serverData.length; y++) {
        if(dataJson[i].light === serverData[y].light) {
          serverData[y] = dataJson[i]
        }
      }
    }

    for(let i = 0; i < serverData.length; i++) {
      let light = serverData[i]
      let cl = 'card text-white bg-danger mb-3'

      switch(light.status) {
        case "green":
          cl = 'card text-white bg-success mb-3'
          break
		case "orange":
		  cl = 'card text-white bg-warning mb-3'
		  break
		case "red":
		  cl = 'card text-white bg-danger mb-3'
		  break
      }

      $("#" + light.light).attr('class', cl);
    }
  })

</script>
<script type="text/javascript" src="./dist/vendor.bundle.js"></script>
<script type="text/javascript" src="./dist/bundle.js"></script>
</body>


</html>
